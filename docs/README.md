# 📚 项目文档

这里包含了 Telegram Summary Bot 项目的所有详细文档。

## 📋 文档目录

| 文档 | 描述 |
|------|------|
| [PM2-DEPLOYMENT.md](PM2-DEPLOYMENT.md) | 🚀 **PM2 部署教程** - 详细的生产环境部署指南，包括安装、配置、监控等 |
| [CONTRIBUTING.md](CONTRIBUTING.md) | 🤝 **贡献指南** - 如何参与项目开发的完整指南 |
| [CHANGELOG.md](CHANGELOG.md) | 📝 **更新日志** - 详细的版本更新记录 |

## 🔗 快速链接

### 部署相关
- **[PM2 部署教程](PM2-DEPLOYMENT.md)** - 生产环境部署
- **[环境配置](../env.example)** - 环境变量配置示例

### 开发相关
- **[贡献指南](CONTRIBUTING.md)** - 参与开发
- **[主要文档](../README.md)** - 返回主文档

## 📖 阅读顺序建议

1. **新用户**: 先阅读 [主文档](../README.md) 了解项目概况
2. **部署者**: 参考 [PM2 部署教程](PM2-DEPLOYMENT.md) 进行生产环境部署
3. **开发者**: 查看 [贡献指南](CONTRIBUTING.md) 了解开发规范和流程
4. **版本跟踪**: 关注 [更新日志](CHANGELOG.md) 了解最新变更

---

## 🏆 功能详解

- 🤖 **智能总结**：使用 Azure OpenAI 分析群组聊天记录，支持 1-1000 条消息的深度分析。
- ⚡ **异步处理**：非阻塞式任务队列，用户请求立即响应，后台异步生成总结。
- 🌍 **多语言支持**：自动检测群组主要语言，智能本地化回复。
- 📊 **消息分析**：统计活跃用户、消息数量、参与度等。
- 💾 **自动存储**：实时监听并存储群组消息，最多保留2000条，自动清理7天前数据。
- 🔄 **智能缓存**：总结缓存30分钟，统计缓存10分钟，防止API过度请求。
- 📈 **用户统计**：分析群组活跃用户排行、消息记录。
- 🛡️ **安全防护**：多层安全中间件（速率限制、用户验证、内容过滤），Markdown安全转义。
- 📲 **实时推送**：总结完成后自动推送，无需等待。
- 🔧 **模块化设计**：命令、中间件、工具函数均为独立模块，易于扩展和维护。

## 📝 命令与参数

### 基本命令
- `/start` - 显示欢迎信息和使用说明
- `/help` - 获取详细帮助信息
- `/summary [数量]` - 总结群组最近的聊天记录（数量1-1000，默认100）
- `/status` - 查看机器人和服务状态

### 管理员命令
- `/admin stats [群组ID]` - 查看群组统计信息
- `/admin users [群组ID] [数量]` - 查看活跃用户排行
- `/admin messages [群组ID] [数量]` - 查看最近消息记录
- `/admin cache` - 查看缓存状态
- `/admin clear [群组ID]` - 清除缓存数据

> 参数说明：群组ID可选，不填则使用当前群组；数量可选，默认10。

## ⏩ 使用说明

### 群组使用
1. 邀请机器人到群组，自动开始监听并存储消息。
2. 发送 `/summary` 命令总结最近消息，支持指定数量。
3. 发送 `/status` 查看机器人状态和群组统计。

#### 异步处理体验
- 发送命令后立即收到确认回复，无需等待。
- 总结完成后自动推送结果。
- 遇到问题时自动回退到纯文本格式。

### 私聊使用
- `/start` 查看使用说明
- `/help` 获取命令帮助
- `/status` 查看机器人状态

## 🧩 模块与扩展

### 目录结构
```
commands/     - 命令处理器
middleware/   - 中间件
services/     - 服务层
storage/      - 数据存储
utils/        - 工具函数
```

### 扩展方法
- **添加新命令**：在 `commands/` 目录下创建新文件，导出命令对象，重启机器人自动加载。
- **添加中间件**：在 `middleware/` 目录下创建文件，并在 `bot.js` 注册。
- **添加工具函数**：在 `utils/` 目录下创建文件，按需引入。

## 🔒 安全与数据管理

- **API 限流**：每用户每群组5分钟冷却期，防止频繁调用。
- **用户验证**：支持黑名单和权限控制。
- **内容过滤**：自动过滤不当内容。
- **详细日志**：完整操作和错误日志记录。
- **数据保护**：自动清理旧数据，保护用户隐私。
- **格式安全**：Markdown特殊字符转义，防止解析错误。
- **并发保护**：任务队列防止并发冲突。
- **数据库优化**：定期执行 VACUUM 回收存储空间。

## 🌍 多语言支持

- 支持中文（简/繁）、英语、日语、韩语、西班牙语、法语、德语、俄语等多种语言。
- 自动检测群组主要语言，智能本地化回复。
- 语言识别基于字符模式和语言特征。

---

📌 **提示**: 如果您发现文档有任何问题或需要改进，欢迎提交 Issue 或 Pull Request！ 